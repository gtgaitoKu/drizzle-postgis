'use strict';

var Ae = require('wkx');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var Ae__default = /*#__PURE__*/_interopDefault(Ae);

var De=Object.defineProperty;var E=(e,r)=>{for(var t in r)De(e,t,{get:r[t],enumerable:!0});};var we={};E(we,{box2D:()=>Ge,box2DfromDriver:()=>xe,fromDriver:()=>$,geometry:()=>qe,geometryCollection:()=>We,lineString:()=>Be,multiLineString:()=>Re,multiPoint:()=>Ee,multiPolygon:()=>Ve,point:()=>ze,polygon:()=>Fe});var s=Symbol.for("drizzle:entityKind");function f(e,r){if(!e||typeof e!="object")return !1;if(e instanceof r)return !0;if(!Object.prototype.hasOwnProperty.call(r,s))throw new Error(`Class "${r.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=Object.getPrototypeOf(e).constructor;if(t)for(;t;){if(s in t&&t[s]===r[s])return !0;t=Object.getPrototypeOf(t);}return !1}var w=class{constructor(r,t){this.table=r,this.config=t,this.name=t.name,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity;}static[s]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(r){return r}mapToDriverValue(r){return r}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var B=class{static[s]="ColumnBuilder";config;constructor(r,t,n){this.config={name:r,keyAsName:r==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:n,generated:void 0};}$type(){return this}notNull(){return this.config.notNull=!0,this}default(r){return this.config.default=r,this.config.hasDefault=!0,this}$defaultFn(r){return this.config.defaultFn=r,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(r){return this.config.onUpdateFn=r,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(r){this.config.name===""&&(this.config.name=r);}};var N=Symbol.for("drizzle:Name");var R=class{static[s]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(r,t){this.reference=()=>{let{name:n,columns:i,foreignColumns:u}=r();return {name:n,columns:i,foreignTable:u[0].table,foreignColumns:u}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete);}onUpdate(r){return this._onUpdate=r===void 0?"no action":r,this}onDelete(r){return this._onDelete=r===void 0?"no action":r,this}build(r){return new V(r,this)}},V=class{constructor(r,t){this.table=r,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete;}static[s]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:r,columns:t,foreignColumns:n}=this.reference(),i=t.map(h=>h.name),u=n.map(h=>h.name),d=[this.table[N],...i,n[0].table[N],...u];return r??`${d.join("_")}_fk`}};function F(e,...r){return e(...r)}function j(e,r){return `${e[N]}_${r.join("_")}_unique`}function oe(e,r,t){for(let n=r;n<e.length;n++){let i=e[n];if(i==="\\"){n++;continue}if(i==='"')return [e.slice(r,n).replace(/\\/g,""),n+1];if(!t&&(i===","||i==="}"))return [e.slice(r,n).replace(/\\/g,""),n]}return [e.slice(r).replace(/\\/g,""),e.length]}function ie(e,r=0){let t=[],n=r,i=!1;for(;n<e.length;){let u=e[n];if(u===","){(i||n===r)&&t.push(""),i=!0,n++;continue}if(i=!1,u==="\\"){n+=2;continue}if(u==='"'){let[p,b]=oe(e,n+1,!0);t.push(p),n=b;continue}if(u==="}")return [t,n+1];if(u==="{"){let[p,b]=ie(e,n+1);t.push(p),n=b;continue}let[d,h]=oe(e,n,!1);t.push(d),n=h;}return [t,n]}function se(e){let[r]=ie(e,1);return r}function I(e){return `{${e.map(r=>Array.isArray(r)?I(r):typeof r=="string"?`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${r}`).join(",")}}`}var D=class extends B{foreignKeyConfigs=[];static[s]="PgColumnBuilder";array(r){return new U(this.config.name,this,r)}references(r,t={}){return this.foreignKeyConfigs.push({ref:r,actions:t}),this}unique(r,t){return this.config.isUnique=!0,this.config.uniqueName=r,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(r){return this.config.generated={as:r,type:"always",mode:"stored"},this}buildForeignKeys(r,t){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>F((u,d)=>{let h=new R(()=>{let p=u();return {columns:[r],foreignColumns:[p]}});return d.onUpdate&&h.onUpdate(d.onUpdate),d.onDelete&&h.onDelete(d.onDelete),h.build(t)},n,i))}buildExtraConfigColumn(r){return new K(r,this.config)}},T=class extends w{constructor(r,t){t.uniqueName||(t.uniqueName=j(r,[t.name])),super(r,t),this.table=r;}static[s]="PgColumn"},K=class extends T{static[s]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(r){return this.indexConfig.opClass=r,this}},U=class extends D{static[s]="PgArrayBuilder";constructor(r,t,n){super(r,"array","PgArray"),this.config.baseBuilder=t,this.config.size=n;}build(r){let t=this.config.baseBuilder.build(r);return new _(r,this.config,t)}},_=class e extends T{constructor(r,t,n,i){super(r,t),this.baseColumn=n,this.range=i,this.size=t.size;}size;static[s]="PgArray";getSQLType(){return `${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(r){return typeof r=="string"&&(r=se(r)),r.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(r,t=!1){let n=r.map(i=>i===null?null:f(this.baseColumn,e)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return t?n:I(n)}};var ue=Symbol.for("drizzle:isPgEnum");function le(e){return !!e&&typeof e=="function"&&ue in e&&e[ue]===!0}var v=class{static[s]="Subquery";constructor(r,t,n,i=!1){this._={brand:"Subquery",sql:r,selectedFields:t,alias:n,isWith:i};}};var ce={startActiveSpan(e,r){return r()}};var A=Symbol.for("drizzle:ViewBaseConfig");var H=Symbol.for("drizzle:Schema"),ye=Symbol.for("drizzle:Columns"),de=Symbol.for("drizzle:ExtraConfigColumns"),Y=Symbol.for("drizzle:OriginalName"),k=Symbol.for("drizzle:BaseName"),G=Symbol.for("drizzle:IsAlias"),ge=Symbol.for("drizzle:ExtraConfigBuilder"),Ce=Symbol.for("drizzle:IsDrizzleTable"),O=class{static[s]="Table";static Symbol={Name:N,Schema:H,OriginalName:Y,Columns:ye,ExtraConfigColumns:de,BaseName:k,IsAlias:G,ExtraConfigBuilder:ge};[N];[Y];[H];[ye];[de];[k];[G]=!1;[Ce]=!0;[ge]=void 0;constructor(r,t,n){this[N]=this[Y]=r,this[H]=t,this[k]=n;}};function ee(e){return e!=null&&typeof e.getSQL=="function"}function Qe(e){let r={sql:"",params:[]};for(let t of e)r.sql+=t.sql,r.params.push(...t.params),t.typings?.length&&(r.typings||(r.typings=[]),r.typings.push(...t.typings));return r}var S=class{static[s]="StringChunk";value;constructor(r){this.value=Array.isArray(r)?r:[r];}getSQL(){return new y([this])}},y=class e{constructor(r){this.queryChunks=r;}static[s]="SQL";decoder=be;shouldInlineParams=!1;append(r){return this.queryChunks.push(...r.queryChunks),this}toQuery(r){return ce.startActiveSpan("drizzle.buildSQL",t=>{let n=this.buildQueryFromSourceParams(this.queryChunks,r);return t?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(r,t){let n=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:i,escapeName:u,escapeParam:d,prepareTyping:h,inlineParams:p,paramStartIndex:b}=n;return Qe(r.map(o=>{if(f(o,S))return {sql:o.value.join(""),params:[]};if(f(o,q))return {sql:u(o.value),params:[]};if(o===void 0)return {sql:"",params:[]};if(Array.isArray(o)){let l=[new S("(")];for(let[g,Pe]of o.entries())l.push(Pe),g<o.length-1&&l.push(new S(", "));return l.push(new S(")")),this.buildQueryFromSourceParams(l,n)}if(f(o,e))return this.buildQueryFromSourceParams(o.queryChunks,{...n,inlineParams:p||o.shouldInlineParams});if(f(o,O)){let l=o[O.Symbol.Schema],g=o[O.Symbol.Name];return {sql:l===void 0||o[G]?u(g):u(l)+"."+u(g),params:[]}}if(f(o,w)){let l=i.getColumnCasing(o);if(t.invokeSource==="indexes")return {sql:u(l),params:[]};let g=o.table[O.Symbol.Schema];return {sql:o.table[G]||g===void 0?u(o.table[O.Symbol.Name])+"."+u(l):u(g)+"."+u(o.table[O.Symbol.Name])+"."+u(l),params:[]}}if(f(o,z)){let l=o[A].schema,g=o[A].name;return {sql:l===void 0||o[A].isAlias?u(g):u(l)+"."+u(g),params:[]}}if(f(o,C)){if(f(o.value,Q))return {sql:d(b.value++,o),params:[o],typings:["none"]};let l=o.value===null?null:o.encoder.mapToDriverValue(o.value);if(f(l,e))return this.buildQueryFromSourceParams([l],n);if(p)return {sql:this.mapInlineParam(l,n),params:[]};let g=["none"];return h&&(g=[h(o.encoder)]),{sql:d(b.value++,l),params:[l],typings:g}}return f(o,Q)?{sql:d(b.value++,o),params:[o],typings:["none"]}:f(o,e.Aliased)&&o.fieldAlias!==void 0?{sql:u(o.fieldAlias),params:[]}:f(o,v)?o._.isWith?{sql:u(o._.alias),params:[]}:this.buildQueryFromSourceParams([new S("("),o._.sql,new S(") "),new q(o._.alias)],n):le(o)?o.schema?{sql:u(o.schema)+"."+u(o.enumName),params:[]}:{sql:u(o.enumName),params:[]}:ee(o)?o.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([o.getSQL()],n):this.buildQueryFromSourceParams([new S("("),o.getSQL(),new S(")")],n):p?{sql:this.mapInlineParam(o,n),params:[]}:{sql:d(b.value++,o),params:[o],typings:["none"]}}))}mapInlineParam(r,{escapeString:t}){if(r===null)return "null";if(typeof r=="number"||typeof r=="boolean")return r.toString();if(typeof r=="string")return t(r);if(typeof r=="object"){let n=r.toString();return t(n==="[object Object]"?JSON.stringify(r):n)}throw new Error("Unexpected param value: "+r)}getSQL(){return this}as(r){return r===void 0?this:new e.Aliased(this,r)}mapWith(r){return this.decoder=typeof r=="function"?{mapFromDriverValue:r}:r,this}inlineParams(){return this.shouldInlineParams=!0,this}if(r){return r?this:void 0}},q=class{constructor(r){this.value=r;}static[s]="Name";brand;getSQL(){return new y([this])}};function Se(e){return typeof e=="object"&&e!==null&&"mapToDriverValue"in e&&typeof e.mapToDriverValue=="function"}var be={mapFromDriverValue:e=>e},$e={mapToDriverValue:e=>e};({...be,...$e});var C=class{constructor(r,t=$e){this.value=r,this.encoder=t;}static[s]="Param";brand;getSQL(){return new y([this])}};function a(e,...r){let t=[];(r.length>0||e.length>0&&e[0]!=="")&&t.push(new S(e[0]));for(let[n,i]of r.entries())t.push(i,new S(e[n+1]));return new y(t)}(e=>{function r(){return new y([])}e.empty=r;function t(p){return new y(p)}e.fromList=t;function n(p){return new y([new S(p)])}e.raw=n;function i(p,b){let o=[];for(let[l,g]of p.entries())l>0&&b!==void 0&&o.push(b),o.push(g);return new y(o)}e.join=i;function u(p){return new q(p)}e.identifier=u;function d(p){return new Q(p)}e.placeholder=d;function h(p,b){return new C(p,b)}e.param=h;})(a||(a={}));(e=>{class r{constructor(n,i){this.sql=n,this.fieldAlias=i;}static[s]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new r(this.sql,this.fieldAlias)}}e.Aliased=r;})(y||(y={}));var Q=class{constructor(r){this.name=r;}static[s]="Placeholder";getSQL(){return new y([this])}};var ve=Symbol.for("drizzle:IsDrizzleView"),z=class{static[s]="View";[A];[ve]=!0;constructor({name:r,schema:t,selectedFields:n,query:i}){this[A]={name:r,originalName:r,schema:t,selectedFields:n,query:i,isExisting:!i,isAlias:!1};}getSQL(){return new y([this])}};w.prototype.getSQL=function(){return new y([this])};O.prototype.getSQL=function(){return new y([this])};v.prototype.getSQL=function(){return new y([this])};function c(e,r){return Se(r)&&!ee(e)&&!f(e,C)&&!f(e,Q)&&!f(e,w)&&!f(e,O)&&!f(e,z)?new C(e,r):e}function Oe(e,r){return {name:typeof e=="string"&&e.length>0?e:"",config:typeof e=="object"?e:r}}var re=class extends D{static[s]="PgCustomColumnBuilder";constructor(r,t,n){super(r,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=n;}build(r){return new te(r,this.config)}},te=class extends T{static[s]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(r,t){super(r,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver;}getSQLType(){return this.sqlName}mapFromDriverValue(r){return typeof this.mapFrom=="function"?this.mapFrom(r):r}mapToDriverValue(r){return typeof this.mapTo=="function"?this.mapTo(r):r}};function x(e){return (r,t)=>{let{name:n,config:i}=Oe(r,t);return new re(n,i,e)}}var L=e=>{let r="geometry";return e?.type?(r+=`(${e.type}`,e?.srid&&(r+=`,${e.srid}`),`${r})`):`${r}(Geometry)`};function P(e){return a`ST_GeomFromGeoJSON(${JSON.stringify(e)})`}function $(e){let r=Buffer.from(e,"hex");return Ae__default.default.Geometry.parse(r).toGeoJSON({shortCrs:!0})}function xe(e){let r=e.match(/BOX\((?<xmin>[0-9\.]+),? ?(?<ymin>[0-9\.]+),? ?(?<xmax>[0-9\.]+),? ?(?<ymax>[0-9\.]+)\)/);if(!r?.groups)throw new Error(`Box2D parse error, value: ${e}`);return [Number.parseFloat(r.groups.xmin),Number.parseFloat(r.groups.ymin),Number.parseFloat(r.groups.xmax),Number.parseFloat(r.groups.ymax)]}var Ge=x({dataType:()=>"box2d",toDriver:e=>`BOX(${e[0]} ${e[1]}, ${e[2]} ${e[3]})`,fromDriver:xe}),qe=x({dataType:L,toDriver:e=>P(e),fromDriver:e=>$(e)}),ze=x({dataType:e=>L({type:`Point${e?.is3D?"Z":""}`,...e}),toDriver:e=>P(e),fromDriver:e=>$(e)}),Ee=x({dataType:e=>L({type:`MultiPoint${e?.is3D?"Z":""}`,...e}),toDriver:e=>P(e),fromDriver:e=>$(e)}),Be=x({dataType:e=>L({type:`LineString${e?.is3D?"Z":""}`,...e}),toDriver:e=>P(e),fromDriver:e=>$(e)}),Re=x({dataType:e=>L({type:`MultiLineString${e?.is3D?"Z":""}`,...e}),toDriver:e=>P(e),fromDriver:e=>$(e)}),Fe=x({dataType:e=>L({type:`Polygon${e?.is3D?"Z":""}`,...e}),toDriver:e=>P(e),fromDriver:e=>$(e)}),Ve=x({dataType:e=>L({type:`MultiPolygon${e?.is3D?"Z":""}`,...e}),toDriver:e=>P(e),fromDriver:e=>$(e)}),We=x({dataType:e=>L({type:"GeometryCollection",...e}),toDriver:e=>P(e),fromDriver:e=>$(e)});var Te={};E(Te,{addMeasure:()=>ke,area:()=>je,asText:()=>Ue,closestPoint:()=>Ie,geoHash:()=>Ye,geomFromGeoJSON:()=>He,geomFromText:()=>Ke,isValid:()=>Ze,isValidReason:()=>Xe,x:()=>_e,y:()=>Me});var Ne={};E(Ne,{gisExtensionSchema:()=>m,setPostGISSchema:()=>Je});var m=a.raw("");function Je(e){m=e.length?a.raw(`${e}.`):a.empty();}function je(e){return a`${m}ST_Area(${e})`.mapWith(Number)}function Ie(e,r){return a`${m}ST_ClosestPoint(${e}, ${r})`.mapWith($)}function Ke(e){return a`${m}ST_GeomFromText(${e})`.mapWith($)}function Ue(e){return a`${m}ST_AsText(${e})`}function _e(e){return a`${m}ST_X(${e})`.mapWith(Number)}function Me(e){return a`${m}ST_Y(${e})`.mapWith(Number)}function Ze(e){return a`${m}ST_IsValid(${e},0)`.mapWith(Boolean)}function Xe(e){return a`${m}ST_IsValidReason(${e})`}function He(e){return a`${m}ST_GeomFromGeoJSON(${JSON.stringify(e)})`.mapWith($)}function Ye(e,r=20){return a`${m}ST_GeoHash(${e}, ${r})`}function ke(e,r,t){return a`${m}ST_AddMeasure(${e}, ${r}, ${t})`}var Le={};E(Le,{bboxAbove:()=>ur,bboxBelow:()=>sr,bboxContain:()=>cr,bboxContained:()=>fr,bboxLeft:()=>ir,bboxOverlaps:()=>er,bboxOverlapsND:()=>rr,bboxOverlapsOrAbove:()=>ar,bboxOverlapsOrBelow:()=>nr,bboxOverlapsOrLeft:()=>tr,bboxOverlapsOrRight:()=>or,bboxRight:()=>mr,bboxSame:()=>pr,distanceBox:()=>gr,distanceBoxND:()=>Sr,distanceCPA:()=>dr,distanceCentroidND:()=>hr,distanceKNN:()=>yr,eq:()=>lr});var er=(e,r)=>a`${e} OPERATOR(${m}&&) ${c(r,e)}`,rr=(e,r)=>a`${e} OPERATOR(${m}&&&) ${c(r,e)}`,tr=(e,r)=>a`${e} OPERATOR(${m}&<) ${c(r,e)}`,nr=(e,r)=>a`${e} OPERATOR(${m}&<|) ${c(r,e)}`,or=(e,r)=>a`${e} OPERATOR(${m}&>) ${c(r,e)}`,ir=(e,r)=>a`${e} OPERATOR(${m}<<) ${c(r,e)}`,sr=(e,r)=>a`${e} OPERATOR(${m}<<|) ${c(r,e)}`,ar=(e,r)=>a`${e} OPERATOR(${m}|&>) ${c(r,e)}`,ur=(e,r)=>a`${e} OPERATOR(${m}|>>) ${c(r,e)}`,mr=(e,r)=>a`${e} OPERATOR(${m}>>) ${c(r,e)}`,lr=(e,r)=>a`${e} OPERATOR(${m}=) ${c(r,e)}`,pr=(e,r)=>a`${e} OPERATOR(${m}~=) ${c(r,e)}`,fr=(e,r)=>a`${e} OPERATOR(${m}@) ${c(r,e)}`,cr=(e,r)=>a`${e} OPERATOR(${m}~) ${c(r,e)}`,yr=(e,r)=>a`${e} OPERATOR(${m}<->) ${c(r,e)}`,dr=(e,r)=>a`${e} OPERATOR(${m}|=|) ${c(r,e)}`,gr=(e,r)=>a`${e} OPERATOR(${m}<#>) ${c(r,e)}`,hr=(e,r)=>a`${e} OPERATOR(${m}<<->>) ${c(r,e)}`,Sr=(e,r)=>a`${e} OPERATOR(${m}<<#>>) ${c(r,e)}`;

exports.config = Ne;
exports.functions = Te;
exports.models = we;
exports.operators = Le;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map