'use strict';

var Ce = require('wkx');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var Ce__default = /*#__PURE__*/_interopDefault(Ce);

var s=Symbol.for("drizzle:entityKind");function p(t,e){if(!t||typeof t!="object")return !1;if(t instanceof e)return !0;if(!Object.prototype.hasOwnProperty.call(e,s))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(s in r&&r[s]===e[s])return !0;r=Object.getPrototypeOf(r);}return !1}var w=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity;}static[s]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var z=class{static[s]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0};}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e);}};var S=Symbol.for("drizzle:Name");var A=class{static[s]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:o,foreignColumns:a}=e();return {name:n,columns:o,foreignTable:a[0].table,foreignColumns:a}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete);}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new $(e,this)}},$=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete;}static[s]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),o=r.map(y=>y.name),a=n.map(y=>y.name),f=[this.table[S],...o,n[0].table[S],...a];return e??`${f.join("_")}_fk`}};function F(t,...e){return t(...e)}function Q(t,e){return `${t[S]}_${e.join("_")}_unique`}function ee(t,e,r){for(let n=e;n<t.length;n++){let o=t[n];if(o==="\\"){n++;continue}if(o==='"')return [t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(o===","||o==="}"))return [t.slice(e,n).replace(/\\/g,""),n]}return [t.slice(e).replace(/\\/g,""),t.length]}function te(t,e=0){let r=[],n=e,o=!1;for(;n<t.length;){let a=t[n];if(a===","){(o||n===e)&&r.push(""),o=!0,n++;continue}if(o=!1,a==="\\"){n+=2;continue}if(a==='"'){let[l,d]=ee(t,n+1,!0);r.push(l),n=d;continue}if(a==="}")return [r,n+1];if(a==="{"){let[l,d]=te(t,n+1);r.push(l),n=d;continue}let[f,y]=ee(t,n,!1);r.push(f),n=y;}return [r,n]}function re(t){let[e]=te(t,1);return e}function K(t){return `{${t.map(e=>Array.isArray(e)?K(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var x=class extends z{foreignKeyConfigs=[];static[s]="PgColumnBuilder";array(e){return new U(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:o})=>F((a,f)=>{let y=new A(()=>{let l=a();return {columns:[e],foreignColumns:[l]}});return f.onUpdate&&y.onUpdate(f.onUpdate),f.onDelete&&y.onDelete(f.onDelete),y.build(r)},n,o))}buildExtraConfigColumn(e){return new I(e,this.config)}},N=class extends w{constructor(e,r){r.uniqueName||(r.uniqueName=Q(e,[r.name])),super(e,r),this.table=e;}static[s]="PgColumn"},I=class extends N{static[s]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},U=class extends x{static[s]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n;}build(e){let r=this.config.baseBuilder.build(e);return new B(e,this.config,r)}},B=class t extends N{constructor(e,r,n,o){super(e,r),this.baseColumn=n,this.range=o,this.size=r.size;}size;static[s]="PgArray";getSQLType(){return `${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=re(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(o=>o===null?null:p(this.baseColumn,t)?this.baseColumn.mapToDriverValue(o,!0):this.baseColumn.mapToDriverValue(o));return r?n:K(n)}};var ie=Symbol.for("drizzle:isPgEnum");function se(t){return !!t&&typeof t=="function"&&ie in t&&t[ie]===!0}var O=class{static[s]="Subquery";constructor(e,r,n,o=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:o};}};var le={startActiveSpan(t,e){return e()}};var P=Symbol.for("drizzle:ViewBaseConfig");var Z=Symbol.for("drizzle:Schema"),me=Symbol.for("drizzle:Columns"),fe=Symbol.for("drizzle:ExtraConfigColumns"),R=Symbol.for("drizzle:OriginalName"),W=Symbol.for("drizzle:BaseName"),T=Symbol.for("drizzle:IsAlias"),ce=Symbol.for("drizzle:ExtraConfigBuilder"),be=Symbol.for("drizzle:IsDrizzleTable"),h=class{static[s]="Table";static Symbol={Name:S,Schema:Z,OriginalName:R,Columns:me,ExtraConfigColumns:fe,BaseName:W,IsAlias:T,ExtraConfigBuilder:ce};[S];[R];[Z];[me];[fe];[W];[T]=!1;[be]=!0;[ce]=void 0;constructor(e,r,n){this[S]=this[R]=e,this[Z]=r,this[W]=n;}};function Se(t){return t!=null&&typeof t.getSQL=="function"}function Ne(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var g=class{static[s]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e];}getSQL(){return new m([this])}},m=class t{constructor(e){this.queryChunks=e;}static[s]="SQL";decoder=ye;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return le.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:o,escapeName:a,escapeParam:f,prepareTyping:y,inlineParams:l,paramStartIndex:d}=n;return Ne(e.map(i=>{if(p(i,g))return {sql:i.value.join(""),params:[]};if(p(i,G))return {sql:a(i.value),params:[]};if(i===void 0)return {sql:"",params:[]};if(Array.isArray(i)){let u=[new g("(")];for(let[c,he]of i.entries())u.push(he),c<i.length-1&&u.push(new g(", "));return u.push(new g(")")),this.buildQueryFromSourceParams(u,n)}if(p(i,t))return this.buildQueryFromSourceParams(i.queryChunks,{...n,inlineParams:l||i.shouldInlineParams});if(p(i,h)){let u=i[h.Symbol.Schema],c=i[h.Symbol.Name];return {sql:u===void 0||i[T]?a(c):a(u)+"."+a(c),params:[]}}if(p(i,w)){let u=o.getColumnCasing(i);if(r.invokeSource==="indexes")return {sql:a(u),params:[]};let c=i.table[h.Symbol.Schema];return {sql:i.table[T]||c===void 0?a(i.table[h.Symbol.Name])+"."+a(u):a(c)+"."+a(i.table[h.Symbol.Name])+"."+a(u),params:[]}}if(p(i,X)){let u=i[P].schema,c=i[P].name;return {sql:u===void 0||i[P].isAlias?a(c):a(u)+"."+a(c),params:[]}}if(p(i,L)){if(p(i.value,q))return {sql:f(d.value++,i),params:[i],typings:["none"]};let u=i.value===null?null:i.encoder.mapToDriverValue(i.value);if(p(u,t))return this.buildQueryFromSourceParams([u],n);if(l)return {sql:this.mapInlineParam(u,n),params:[]};let c=["none"];return y&&(c=[y(i.encoder)]),{sql:f(d.value++,u),params:[u],typings:c}}return p(i,q)?{sql:f(d.value++,i),params:[i],typings:["none"]}:p(i,t.Aliased)&&i.fieldAlias!==void 0?{sql:a(i.fieldAlias),params:[]}:p(i,O)?i._.isWith?{sql:a(i._.alias),params:[]}:this.buildQueryFromSourceParams([new g("("),i._.sql,new g(") "),new G(i._.alias)],n):se(i)?i.schema?{sql:a(i.schema)+"."+a(i.enumName),params:[]}:{sql:a(i.enumName),params:[]}:Se(i)?i.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([i.getSQL()],n):this.buildQueryFromSourceParams([new g("("),i.getSQL(),new g(")")],n):l?{sql:this.mapInlineParam(i,n),params:[]}:{sql:f(d.value++,i),params:[i],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return "null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},G=class{constructor(e){this.value=e;}static[s]="Name";brand;getSQL(){return new m([this])}};var ye={mapFromDriverValue:t=>t},de={mapToDriverValue:t=>t};({...ye,...de});var L=class{constructor(e,r=de){this.value=e,this.encoder=r;}static[s]="Param";brand;getSQL(){return new m([this])}};function V(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new g(t[0]));for(let[n,o]of e.entries())r.push(o,new g(t[n+1]));return new m(r)}(t=>{function e(){return new m([])}t.empty=e;function r(l){return new m(l)}t.fromList=r;function n(l){return new m([new g(l)])}t.raw=n;function o(l,d){let i=[];for(let[u,c]of l.entries())u>0&&d!==void 0&&i.push(d),i.push(c);return new m(i)}t.join=o;function a(l){return new G(l)}t.identifier=a;function f(l){return new q(l)}t.placeholder=f;function y(l,d){return new L(l,d)}t.param=y;})(V||(V={}));(t=>{class e{constructor(n,o){this.sql=n,this.fieldAlias=o;}static[s]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e;})(m||(m={}));var q=class{constructor(e){this.name=e;}static[s]="Placeholder";getSQL(){return new m([this])}};var De=Symbol.for("drizzle:IsDrizzleView"),X=class{static[s]="View";[P];[De]=!0;constructor({name:e,schema:r,selectedFields:n,query:o}){this[P]={name:e,originalName:e,schema:r,selectedFields:n,query:o,isExisting:!o,isAlias:!1};}getSQL(){return new m([this])}};w.prototype.getSQL=function(){return new m([this])};h.prototype.getSQL=function(){return new m([this])};O.prototype.getSQL=function(){return new m([this])};function ge(t,e){return {name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}var H=class extends x{static[s]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n;}build(e){return new Y(e,this.config)}},Y=class extends N{static[s]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver;}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function b(t){return (e,r)=>{let{name:n,config:o}=ge(e,r);return new H(n,o,t)}}var D=t=>{let e="geometry";return t?.type?(e+=`(${t.type}`,t?.srid&&(e+=`,${t.srid}`),`${e})`):`${e}(Geometry)`};function C(t){return V`ST_GeomFromGeoJSON(${JSON.stringify(t)})`}function v(t){let e=Buffer.from(t,"hex");return Ce__default.default.Geometry.parse(e).toGeoJSON({shortCrs:!0})}function ve(t){let e=t.match(/BOX\((?<xmin>[0-9\.]+),? ?(?<ymin>[0-9\.]+),? ?(?<xmax>[0-9\.]+),? ?(?<ymax>[0-9\.]+)\)/);if(!e?.groups)throw new Error(`Box2D parse error, value: ${t}`);return [Number.parseFloat(e.groups.xmin),Number.parseFloat(e.groups.ymin),Number.parseFloat(e.groups.xmax),Number.parseFloat(e.groups.ymax)]}var vt=b({dataType:()=>"box2d",toDriver:t=>`BOX(${t[0]} ${t[1]}, ${t[2]} ${t[3]})`,fromDriver:ve}),wt=b({dataType:D,toDriver:t=>C(t),fromDriver:t=>v(t)}),xt=b({dataType:t=>D({type:`Point${t?.is3D?"Z":""}`,...t}),toDriver:t=>C(t),fromDriver:t=>v(t)}),Ot=b({dataType:t=>D({type:`MultiPoint${t?.is3D?"Z":""}`,...t}),toDriver:t=>C(t),fromDriver:t=>v(t)}),Pt=b({dataType:t=>D({type:`LineString${t?.is3D?"Z":""}`,...t}),toDriver:t=>C(t),fromDriver:t=>v(t)}),Tt=b({dataType:t=>D({type:`MultiLineString${t?.is3D?"Z":""}`,...t}),toDriver:t=>C(t),fromDriver:t=>v(t)}),Gt=b({dataType:t=>D({type:`Polygon${t?.is3D?"Z":""}`,...t}),toDriver:t=>C(t),fromDriver:t=>v(t)}),qt=b({dataType:t=>D({type:`MultiPolygon${t?.is3D?"Z":""}`,...t}),toDriver:t=>C(t),fromDriver:t=>v(t)}),zt=b({dataType:t=>D({type:"GeometryCollection",...t}),toDriver:t=>C(t),fromDriver:t=>v(t)});

exports.box2D = vt;
exports.box2DfromDriver = ve;
exports.fromDriver = v;
exports.geometry = wt;
exports.geometryCollection = zt;
exports.lineString = Pt;
exports.multiLineString = Tt;
exports.multiPoint = Ot;
exports.multiPolygon = qt;
exports.point = xt;
exports.polygon = Gt;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=models.js.map